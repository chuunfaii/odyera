{% extends "base.html" %}
{% load static %}
{% load humanize %}

{% block content %}

<div class="mx-auto w-full flex flex-col h-16 max-w-screen-xl items-center gap-8 px-4 sm:px-6 lg:px-8 justify-between">
    <div class="grid grid-cols-2 w-full gap-x-20">
        <div class="mt-8 bg-white border border-slate-100 shadow rounded-xl py-5 px-10">
            <h2 class="font-semibold">You've made a total sales of</h2>
            <p class="font-bold text-2xl py-2 text-green-500">RM {{ total_sales|intcomma }}</p>
            <span class="text-gray-500 ">with a total of <span class="font-semibold">{{ total_orders }}</span> order{% if total_orders > 1 %}s{% endif %}</span>
        </div>
        <div class="mt-8 bg-white border border-slate-100 shadow rounded-xl py-5 px-10">
            <h2 class="font-semibold">Recommended Price Range for Menu Items:</h2>
            <p class="font-bold text-2xl py-2">RM {{ recommended_price_range.min_price }} - RM {{ recommended_price_range.max_price }}</p>
        </div>
        <div>
            <div class="flex flex-col bg-white border border-slate-100 mt-8 shadow rounded-xl ">
                <h2 class="font-semibold py-3 px-5 text-center pt-8">
                    Top Selling Restaurant's Menu Item
                </h2>
                <table class="w-full text-gray-500 mb-4">
                    <tbody>
                        {% for item in top_restaurant_items %}
                            <tr class="{% if forloop.counter != 5 %}border-b border-slate-100{% endif %} hover:bg-gray-50">
                                <td class="py-4 w-1/3 text-center">
                                    {{ forloop.counter }}
                                </td>
                                <td class="py-4 w-full">
                                    {{ item.name }}
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            <div class="bg-white border border-slate-100 mt-8 shadow rounded-xl mb-8">
                <canvas class="m-auto self-center" id="chartPie"></canvas>
            </div>
        </div>
        <div class="mt-8 bg-white border border-slate-100 shadow rounded-xl mb-8">
            <h2 class="font-semibold py-3 px-5 text-center pt-8">
                Top 10 {{ cuisine }} Menu Items in Malaysia
            </h2>
            <table class="w-full text-gray-500">
                <tbody>
                    {% for item in top_cuisine_items %}
                        <tr class="{% if forloop.counter != 10 %}border-b border-slate-100{% endif %} hover:bg-gray-50">
                            <td class="py-4 w-1/3 text-center">
                                {{ forloop.counter }}
                            </td>
                            <td class="py-4 w-1/2">
                                {{ item.name }}
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- Restaurant CRUD -->
    <div class="w-full pb-8">

        <div class="flex items-center radius-lg justify-between ">
            <h2 class="font-semibold text-xl py-3 px-2 pt-8">Menu Items</h2>
            <button class="button bg-white border border-gray-300 text-sm hover:bg-gray-50 rounded-lg px-3 py-2 border-1 text-gray-700">Add new menu item</button>
        </div>
        <div class="shadow">

            <table class="w-full text-sm text-left text-gray-500">
                <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                    <tr>
                        <th scope="col " class="py-3 px-6">
                            Image
                        </th>
                        <th scope="col" class="py-3 px-6">
                            Name
                        </th>
                        <th scope="col" class="py-3 px-6">
                            Description
                        </th>
                        <th scope="col" class="py-3 px-6">
                            Price
                        </th>
                        <th scope="col" class="py-3 px-6">
                            <span class="sr-only">Edit</span>
                        </th>
                        <th scope="col" class="py-3 px-6">
                            <span class="sr-only">Delete</span>
                        </th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in menu_items%}


                    <tr class="bg-white border-b hover:bg-gray-50">

                        <th scope="row" class="py-4 px-6 font-medium text-gray-900 whitespace-nowrap">
                            <img src="{% static '/images/' %}{{item.image_url}}" width="50px" height="50px">
                        </th>
                        <td class="py-4 px-6">
                            {{item.name}}
                        </td>
                        <td class="py-4 px-6">
                            {{item.description}}
                        </td>
                        <td class="py-4 px-6">
                            RM{{item.price}}
                        </td>
                        <td class="py-4 px-6 text-right">
                            <a href="#" class="font-medium text-blue-600 hover:underline">Edit</a>
                        </td>
                        <td class="py-4 px-6 text-right">
                            <a href="#" class="font-medium text-red-600 hover:underline">Delete</a>
                        </td>

                    </tr>

                    {% endfor %}

                </tbody>
            </table>
        </div>
    </div>



</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    const dataPie = {
        labels: [
            {% for item in top_restaurant_items %}
                "{{ item.name }}",
            {% endfor %}
        ],
        datasets: [
            {
                data: [
                    {% for item in top_restaurant_items %}
                        {{ item.quantity }},
                    {% endfor %}
                ],
                backgroundColor: [
                "#9BBFE0",
                "#E8A09A",
                "#FBE29F",
                "#C6D68F",
                "#64C2A6",
                ],
                hoverOffset: 4,
            },
        ],
    };

    const configPie = {
        type: "pie",
        data: dataPie,
        options: {},
    };

    var chartBar = new Chart(document.getElementById("chartPie"), configPie);
</script>

{% endblock %}
